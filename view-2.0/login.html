<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="CSS/login.css">    
</head>

<body>
    <div class="faixa-topo"></div>
        <div class="univap-logo">
          <img src="Imagens/Univap[Negativo].png" alt="Logo Univap">
        </div>
      <div class="faixa-base"></div>

      <div class="login-text">
        <p>Login</p>
      </div>

      <div class="email-barra">
        <input type="email" id="txtEmail" value='' placeholder="Email">
      </div>

    <div class="senha-barra">
      <input type="password" id="txtSenha" value="" placeholder="Senha">
    </div>

    <div class="red-button">
      <button class="login-button" id="btnLogin">Login</button>
    </div>

    <div id="divResposta"></div>

<script>
  const btnLogin = document.getElementById('btnLogin');
  const txtEmailFuncionario = document.getElementById("txtEmail");
  const txtSenhaFuncionario = document.getElementById("txtSenha");
  const divResposta = document.getElementById("divResposta");

  btnLogin.onclick = function () {
    fazerLogin();
  }

  function fazerLogin() {
    const emailFuncionario = txtEmailFuncionario.value;
    const senhaFuncionario = txtSenhaFuncionario.value;

    const obj_json = {
      funcionario: {
      emailFuncionario: emailFuncionario,
      senhaFuncionario: senhaFuncionario
      }
    };
      
    const uri = 'http://localhost:5050/login'; // Certifique-se de que este é o URL correto

    fetch(uri, {
      method: "POST",
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(obj_json)
    })
    .then((resposta_backEnd) => {
      return resposta_backEnd.text();
    })
    .then((texto_resposta_back) => {
      console.log(texto_resposta_back);
      processarResultados(texto_resposta_back);
    })
    .catch((error) => {
      console.log(error);
    })
  }

  function processarResultados(texto_json) {
    try {
      const obj_json = JSON.parse(texto_json);

      if (obj_json.status === false) {
          alert('Usuário ou senha inválida');
      } else {
          //alert("Bem-Vindo!");
          //localStorage.setItem("dados", texto_json);
          window.location.href = 'painel.html';
      }
    } catch (e) {
      console.error("Erro ao processar o JSON: ", e);
    }
  }
</script>
</body>
</html>